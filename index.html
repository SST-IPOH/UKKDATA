<!DOCTYPE html>
<html lang="ms">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DATA PELANGGAN - UNIT KONSULTASI DAN KIOSK CDN IPOH</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .header-bg {
      background-color: #1e40af;
    }
    .footer-text {
      color: #6b7280;
      font-size: 0.875rem;
    }
    .loading-spinner {
      display: inline-block;
      width: 1rem;
      height: 1rem;
      border: 2px solid rgba(255,255,255,.3);
      border-radius: 50%;
      border-top-color: #fff;
      animation: spin 1s ease-in-out infinite;
      margin-left: 8px;
      vertical-align: middle;
    }
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    .btn-submit {
      transition: all 0.3s ease;
    }
    .data-entry {
      transition: all 0.3s ease;
    }
    .data-entry:hover {
      background-color: #f3f4f6;
    }
  </style>
</head>
<body class="bg-gray-100 p-4">
  <div class="max-w-4xl mx-auto bg-white rounded-lg shadow-md overflow-hidden">
    <!-- Header Section -->
    <div class="header-bg text-white p-4 text-center">
      <h1 class="text-2xl font-bold">DATA PELANGGAN</h1>
      <p class="text-sm">UNIT KONSULTASI DAN KIOSK CDN IPOH</p>
    </div>

    <!-- Form Section -->
    <div class="p-6">
      <form id="dataForm" class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Tarikh</label>
          <input type="date" name="tarikh" id="currentDate" class="p-2 border rounded w-full" required>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Masa</label>
          <input type="time" name="masa" id="currentTime" class="p-2 border rounded w-full" required>
        </div>

        <input type="text" name="namaPelanggan" placeholder="Nama Pelanggan" class="p-2 border rounded" required>
        <input type="text" name="namaSyarikat" placeholder="Nama Syarikat" class="p-2 border rounded">

        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Kaedah</label>
          <select name="kaedah" class="p-2 border rounded w-full">
            <option value="">Pilih Kaedah</option>
            <option value="Bersemuka">Bersemuka</option>
            <option value="Telefon">Telefon</option>
            <option value="Emel">Emel</option>
            <option value="Surat">Surat</option>
          </select>
        </div>

        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">No. Telefon</label>
            <input type="tel" name="telefon" placeholder="No. Telefon" class="p-2 border rounded w-full">
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Emel</label>
            <input type="email" name="emel" placeholder="Emel" class="p-2 border rounded w-full">
          </div>
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Pegawai</label>
          <select name="pegawai" class="p-2 border rounded w-full">
            <option value="">Pilih Pegawai</option>
            <option value="Santhanavel Ramesh A/L Subramaniam">Santhanavel Ramesh A/L Subramaniam</option>
            <option value="Mohamed Inmran bin Sahul Hamid">Mohamed Inmran bin Sahul Hamid</option>
            <option value="Haziq bin Zakaria">Haziq bin Zakaria</option>
            <option value="Mohd Nazri bin Mohd Noh">Mohd Nazri bin Mohd Noh</option>
            <option value="Siti Bahayah binti Baharom">Siti Bahayah binti Baharom</option>
            <option value="Nur Hawari binti Mohd Johar @ Mohd Johan">Nur Hawari binti Mohd Johar @ Mohd Johan</option>
            <option value="Noor Umaira binti Md Yusop">Noor Umaira binti Md Yusop</option>
            <option value="Siti Zulaikha bint Eroi">Siti Zulaikha bint Eroi</option>
            <option value="Umum">Umum</option>
          </select>
        </div>

        <div class="col-span-1 md:col-span-2 space-y-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Perkara</label>
            <select name="perkara" class="p-2 border rounded w-full">
              <option value="">Pilih Perkara</option>
              <option value="Cukai Jualan">Cukai Jualan</option>
              <option value="Cukai Perkhidmatan">Cukai Perkhidmatan</option>
              <option value="GST">GST</option>
              <option value="Cukai Pelancongan">Cukai Pelancongan</option>
              <option value="Duti Import">Duti Import</option>
              <option value="LMW">LMW</option>
              <option value="FIZ">FIZ</option>
              <option value="ABT">ABT</option>
              <option value="Lain-Lain">Lain-Lain</option>
            </select>
          </div>

          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Isu</label>
            <select name="isu" class="p-2 border rounded w-full">
              <option value="">Pilih Isu</option>
              <option value="Aduan/Lain-Lain">Aduan/Lain-Lain</option>
              <option value="Audit">Audit</option>
              <option value="B2B Exemption">B2B Exemption</option>
              <option value="BOD">BOD</option>
              <option value="Pembatalan">Pembatalan</option>
              <option value="Pembatalan Pengecualian">Pembatalan Pengecualian</option>
              <option value="Penalti">Penalti</option>
              <option value="Pendaftaran">Pendaftaran</option>
              <option value="Pengecualian Cukai">Pengecualian Cukai</option>
              <option value="Penukaran Alamat">Penukaran Alamat</option>
              <option value="Penukaran Emel">Penukaran Emel</option>
              <option value="Penyata">Penyata</option>
              <option value="Penyata SST-02 Pembayaran">Penyata SST-02 Pembayaran</option>
              <option value="Penyata SST-02 Penghantaran">Penyata SST-02 Penghantaran</option>
              <option value="Pertanyaan Nilai Cukai">Pertanyaan Nilai Cukai</option>
              <option value="Refund / Drawback">Refund / Drawback</option>
              <option value="Remisi">Remisi</option>
              <option value="Reset Password">Reset Password</option>
              <option value="Senarai hitam Imigresen">Senarai hitam Imigresen</option>
              <option value="Invoice">Invoice</option>
            </select>
          </div>

          <textarea name="pertanyaan" placeholder="Pertanyaan" class="p-2 border rounded w-full h-32"></textarea>
          <textarea name="jawapan" placeholder="Jawapan" class="p-2 border rounded w-full h-32"></textarea>
        </div>

        <button type="submit" class="btn-submit bg-blue-600 text-white p-2 rounded col-span-1 md:col-span-2 hover:bg-blue-700 transition flex items-center justify-center">
          <span id="submit-text">Hantar</span>
          <span id="spinner" class="loading-spinner" style="display:none;"></span>
        </button>
      </form>

      <!-- Data List Section -->
      <div id="dataList" class="mt-6 space-y-4">
        <div class="flex justify-between items-center border-b pb-2">
          <h2 class="text-xl font-semibold">@hak milik UKK 2025</h2>
          <div>
            <button onclick="clearAllData()" class="bg-red-500 text-white p-2 rounded hover:bg-red-600 mr-2">Kosongkan Semua</button>
            <button onclick="downloadExcel()" class="bg-green-600 text-white p-2 rounded hover:bg-green-700">Muat Turun Excel</button>
          </div>
        </div>
        <div id="entriesContainer" class="space-y-4"></div>
      </div>
    </div>
  </div>

  <!-- SheetJS CDN -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

  <script>
    // Initialize form with current date and time
    document.addEventListener('DOMContentLoaded', function() {
      const now = new Date();
      const dateStr = now.toISOString().split('T')[0];
      const timeStr = now.toTimeString().substring(0, 5);
      
      document.getElementById('currentDate').value = dateStr;
      document.getElementById('currentTime').value = timeStr;
      
      loadData();
    });

    const form = document.getElementById('dataForm');
    const submitText = document.getElementById('submit-text');
    const spinner = document.getElementById('spinner');
    const entriesContainer = document.getElementById('entriesContainer');

    // Load data from localStorage
    function loadData() {
      const savedData = localStorage.getItem('customerData');
      if (savedData) {
        const data = JSON.parse(savedData);
        renderData(data);
      }
    }

    // Save data to localStorage
    function saveData(data) {
      localStorage.setItem('customerData', JSON.stringify(data));
    }

    // Render data to the page
    function renderData(data) {
      entriesContainer.innerHTML = '';
      
      if (data.length === 0) {
        entriesContainer.innerHTML = '<p class="text-gray-500 text-center py-4">Tiada data disimpan.</p>';
        return;
      }
      
      data.forEach((entry, index) => {
        const entryDiv = document.createElement('div');
        entryDiv.className = 'data-entry border-b pb-4 pt-2 px-2 rounded';
        entryDiv.dataset.index = index;
        
        let entryHTML = `<div class="flex justify-between items-start mb-2">
          <h3 class="font-medium text-blue-600">Rekod #${index + 1}</h3>
          <button onclick="deleteEntry(${index})" class="text-red-500 hover:text-red-700 text-sm">Padam</button>
        </div>`;
        
        for (const key in entry) {
          if (entry[key]) {
            const displayKey = key.replace(/([A-Z])/g, ' $1').toUpperCase();
            entryHTML += `<p class="mb-1"><strong>${displayKey}:</strong> ${entry[key]}</p>`;
          }
        }
        
        entryDiv.innerHTML = entryHTML;
        entriesContainer.appendChild(entryDiv);
      });
    }

    // Delete a specific entry
    function deleteEntry(index) {
      if (confirm('Adakah anda pasti ingin memadam rekod ini?')) {
        const savedData = JSON.parse(localStorage.getItem('customerData'));
        savedData.splice(index, 1);
        saveData(savedData);
        renderData(savedData);
      }
    }

    // Clear all data
    function clearAllData() {
      if (confirm('Adakah anda pasti ingin mengosongkan semua data?')) {
        localStorage.removeItem('customerData');
        entriesContainer.innerHTML = '<p class="text-gray-500 text-center py-4">Tiada data disimpan.</p>';
      }
    }

    // Form submission handler
    form.addEventListener('submit', (e) => {
      e.preventDefault();
      submitText.style.display = 'none';
      spinner.style.display = 'inline-block';

      setTimeout(() => {
        const formData = new FormData(form);
        const entry = {};
        
        formData.forEach((value, key) => {
          if (value) entry[key] = value;
        });

        // Get existing data or initialize empty array
        const savedData = localStorage.getItem('customerData') 
          ? JSON.parse(localStorage.getItem('customerData')) 
          : [];
        
        // Add new entry
        savedData.unshift(entry); // Add to beginning of array
        saveData(savedData);
        renderData(savedData);

        // Reset form but keep date/time current
        form.reset();
        const now = new Date();
        document.getElementById('currentDate').value = now.toISOString().split('T')[0];
        document.getElementById('currentTime').value = now.toTimeString().substring(0, 5);
        
        submitText.style.display = 'inline';
        spinner.style.display = 'none';
      }, 500);
    });

    // Download Excel function
    function downloadExcel() {
      const savedData = localStorage.getItem('customerData');
      if (!savedData || JSON.parse(savedData).length === 0) {
        alert('Tiada data untuk dimuat turun.');
        return;
      }

      const data = JSON.parse(savedData);
      
      // Format data for Excel with proper column names
      const formattedData = data.map(entry => {
        const formattedEntry = {};
        for (const key in entry) {
          const displayKey = key.replace(/([A-Z])/g, ' $1').toUpperCase();
          formattedEntry[displayKey] = entry[key];
        }
        return formattedEntry;
      });

      const worksheet = XLSX.utils.json_to_sheet(formattedData);
      const workbook = XLSX.utils.book_new();
      XLSX.utils.book_append_sheet(workbook, worksheet, 'Data Pelanggan');

      const dateStr = new Date().toISOString().split('T')[0];
      XLSX.writeFile(workbook, `data_pelanggan_${dateStr}.xlsx`);
    }
  </script>
</body>
</html>